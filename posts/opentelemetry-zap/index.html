<!doctype html><html lang=ja dir=" auto">
<head>
<script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>OpenTelemetryのログ仕様をZAPで実装してみる | lottoHub</title>
<meta name=keywords content="Go">
<meta name=description content="この記事について まだOpenTelemetryのログに対しては仕様が固まっていない状況だが、情報がまとまっていないのでいろいろGithub見">
<meta name=author content="lottotto">
<link rel=canonical href=https://www.lottohub.jp/posts/opentelemetry-zap/>
<meta name=google-site-verification content="cEAh7wHX2RXv01DAtfJ0kKlO2AEfzJyCxNbEMsQYblo">
<link crossorigin=anonymous href=/assets/css/stylesheet.min.1de1b112c4f9c8264eaa9a986d79d2e7a89fd7fb5adc46d288b14a6fc616d99f.css integrity="sha256-HeGxEsT5yCZOqpqYbXnS56if1/ta3EbSiLFKb8YW2Z8=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.lottohub.jp/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://www.lottohub.jp/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://www.lottohub.jp/favicon-32x32.png>
<link rel=apple-touch-icon href=https://www.lottohub.jp/apple-touch-icon.png>
<link rel=mask-icon href=https://www.lottohub.jp/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.89.1">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-217291408-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="OpenTelemetryのログ仕様をZAPで実装してみる">
<meta property="og:description" content="この記事について まだOpenTelemetryのログに対しては仕様が固まっていない状況だが、情報がまとまっていないのでいろいろGithub見">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.lottohub.jp/posts/opentelemetry-zap/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-05-02T21:06:46+09:00">
<meta property="article:modified_time" content="2022-05-02T21:06:46+09:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="OpenTelemetryのログ仕様をZAPで実装してみる">
<meta name=twitter:description content="この記事について まだOpenTelemetryのログに対しては仕様が固まっていない状況だが、情報がまとまっていないのでいろいろGithub見">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://www.lottohub.jp/posts/"},{"@type":"ListItem","position":3,"name":"OpenTelemetryのログ仕様をZAPで実装してみる","item":"https://www.lottohub.jp/posts/opentelemetry-zap/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"OpenTelemetryのログ仕様をZAPで実装してみる","name":"OpenTelemetryのログ仕様をZAPで実装してみる","description":"この記事について まだOpenTelemetryのログに対しては仕様が固まっていない状況だが、情報がまとまっていないのでいろいろGithub見","keywords":["Go"],"articleBody":"この記事について まだOpenTelemetryのログに対しては仕様が固まっていない状況だが、情報がまとまっていないのでいろいろGithub見てまとめてみることを目的としている。\nロギングとは wikipedia によると下記のように書かれています\n In computing, a log file is a file that records either events that occur in an operating system or other software runs, or messages between different users of a communication software.　Logging is the act of keeping a log. https://en.wikipedia.org/wiki/Logging_(software)\n コンピューティングでは、ログファイルとは、OSや他のソフトウェアが稼働するときに発生するイベント,またはコミュニケーションソフトウェアでの異なるユーザ間でのメッセージを記録するファイルである。ロギングとはログを保持する行為であるといいます。\nログの目的 上記のログの定義や私個人の経験からログの目的については主に下記の4つが考えられます\n システムのイベントをログから解読し、稼働中か開発中のソフトウェアの障害根本原因を分析するために利用する 法律対応などの背景をもとにソフトウェアが提供する機能の一つとして、データの操作の監査証跡として利用する ログを集計することで、ソフトウェアのメトリックを出したり、レイテンシを出したりするためのプロファイルとして利用する ログを統計分析することで、実行しているユーザの動作やエラーの予防検知などの状態予想などに利用する  ログのベストプラクティス 上記の目的を達成するためにはどのようなログのベストプラクティスが必要なのかを考えていきます。それと私なりの解釈を書いておきます\n ログライブラリを利用すること\n自前でprintfするのは管理が厳しくなるのでやめましょうという話。ベストプラクティスの前の基本動作. javaだったらlogbackだったり、goだったらzapだったり、いろいろ存在する。\nただしlog4jのようなログライブラリへのバグが見つかるケースもあるので注意しておこう 適切なレベルでログを記録すること\ninfoがなにとか、error が何とかはこちらを参照すること。https://ja.wikipedia.org/wiki/Log4j いつも悩むINFOレベルの具体的なケースとしては、サービスにアクセスされたときの開始/終了情報, サービスから他のサービスやDBにアクセスしに行った時の開始/終了情報とかになるのかなぁ。\nWARNについては、例えばDBのアクセスが遅くなったり、キャッシュができなかった時に出すのがよくあるパターンっぽい 適切なログのカテゴリを指定すること\nログを出すときにカテゴリを指定する。例えばモジュールごとだったり、DBのアクセスだったり、監査要件を満たす内容だったりでカテゴリつけると追うのが楽になるはず。 意味のあるログメッセージを出力すること\nsession startとかだけだと何にもわからないので、意味のあるログメッセージを出しておく。運用側の意見が欲しいのでこことか聞いてみるとDevOpsになっていいかも。 ログメッセージは英語で記載すること\nあたりまえ体操 ログメッセージにはコンテキスト情報を記載すること\ntransaction start とかにもcontext情報を付加して、transaction ID: 1qazxsw2 startとかつけるとよりわかりやすくなる。 プログラムが解析しやすいフォーマットでログを出すこと\n構造化しとけ 同時に人間も読めるログのフォーマット形式にすること\n障害分析するのは人間なんだから機械によめるだけじゃなくて人間にも読みやすくしようね。最近はjsonで出すのがトレンド ログに出す量は多すぎても、少なすぎてもいけないこと\nといわれてもぶっちゃけ何取ればいいかわからん。そういう時は開発中はとりあえずログ出しておいて、運用しながら減らせばいい。簡単に減らせるようなアプリの作りにしておく ログを利用する人のことを考えること\n後日読む人は開発者じゃない。他人のことを考えてログを出そう ログを障害分析のためだけに使わないこと\n監査だったり、プロファイラだったり、統計利用だったりする。とくに統計分析とかは手段が目的化しやすいので、分析して何したいのとかを決めておくこと。 ベンダーロックインを避けること\nlog4jとかでバグ見つかるから、ログのライブラリのロックインはきをつけよう。 センシティブな情報をログに出さないこと\nクレカ番号などの個人情報出ると事業おわるよ。  参考: https://www.dataset.com/blog/the-10-commandments-of-logging/\nOpenTelemetryのログの現状 2022年5月現在のOpenTelemetryとしては、下記の状態。https://opentelemetry.io/status/ API: draft SDK: draft Protocol: beta ログのデータモデルとしては実験的だが定義されている様子。APIやSDKなどすべてstableになるのは2~3年以上かかると考えました。 https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/logs/data-model.md 参考:https://event.cloudnativedays.jp/o11y2022/talks/1347\nデータモデル 現在Opentelemetryが例示しているログレコードのフィールドは下記の通り\n   Field Name Description     Timestamp Time when the event occurred.   ObservedTimestamp Time when the event was observed.   TraceId Request trace id.   SpanId Request span id.   TraceFlags W3C trace flag.   SeverityText The severity text (also known as log level).   SeverityNumber Numerical value of the severity.   Body The body of the log record.   Resource Describes the source of the log.   InstrumentationScope Describes the scope that emitted the log.   Attributes Additional information about the event.    特によくわからない、Resourceについては、ログを出しているPodの名前だったり、service名だったり、バージョンだったり、IPアドレスだったりが該当する。またAttributesについては例えばHTTP上の情報などが該当する。より具体的には、UserAgentや、Statusコード、HTTPのパスなどが該当する。 上記の内容をベストプラクティスに従い、プログラムで読みやすく構造化して記録すると下記のようになる\n{ \"Timestamp\": \"1586960586000000000\", \"Attributes\": { \"http.scheme\":\"https\", \"http.host\":\"donut.mycie.com\", \"http.target\":\"/order\", \"http.method\":\"post\", \"http.status_code\":500, \"http.flavor\":\"1.1\", \"http.user_agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36\", }, \"Resource\": { \"service.name\": \"donut_shop\", \"service.version\": \"2.0.0\", \"k8s.pod.uid\": \"1138528c-c36e-11e9-a1a7-42010a800198\", }, \"TraceId\": \"f4dbb3edd765f620\", // this is a byte sequence  // (hex-encoded in JSON)  \"SpanId\": \"43222c2d51a7abe3\", \"SeverityText\": \"INFO\", \"SeverityNumber\": 9, \"Body\": \"20200415T072306-0700 INFO I like donuts\", } ベストプラクティスとの対応状況考察 このログレコードや将来Opentelemetryでログを実装することを考えた時、ベストプラクティスを達成しているかどうかについて考察してみる\n   ベストプラクティス 達成度 根拠     1. ログライブラリを利用すること 達成 今はまだないけどOpentelemetryのライブラリを使うはずなのでできる   2. 適切なレベルでログを記録すること 未達成 ソフトウェアの作りに依存するため判断不可能   3. 適切なログのカテゴリを指定すること 達成 Resource等にカテゴリ情報を記載することで可能   4. 意味のあるログメッセージを出力すること 未達成 ソフトウェアの作り次第   5. ログメッセージは英語で記載すること 達成 ソフトウェアの作り次第だが流石に大丈夫でしょう   6. ログメッセージにはコンテキスト情報を記載すること 達成 Opentelemetryでトレースがあるのでそれを出すだけだと思う   7. プログラムが解析しやすいフォーマットでログを出すこと 達成 JSONで構造化している   8. 同時に人間も読めるログのフォーマット形式にすること 達成 人間読めると思うし、jqでbodyだけ出せば…。改行が重要かな   9. ログに出す量は多すぎても、少なすぎてもいけないこと 未達成 ソフトウェアの作り次第   10. ログを利用する人のことを考えること 未達成 ソフトウェアの作り次第   11. ログを障害分析のためだけに使わないこと 達成 運用側次第だが、障害分析以外にも使える準備はできてる   12. ベンダーロックインを避けること 達成 Opentelemetryの考え方がベンダロックイン防止   13. センシティブな情報をログに出さないこと 未達成 ソフトウェアの作り次第    ということで、Opentelemetryのフォーマットに従うだけで、8/13は達成しているのかなと思われる。\nOpentelemetryのログ対応を代わりにzapで実装してみる では上記のログレコードの形式で実装することで、結構ベストプラクティスを満たせそうなのでZapの練習がてらにやってみることとする。\nZapの初期設定に関しては下記の通り。Qiitaなどに記事が載っているのでそちらを参考にしました。ポイントとしては特にありません。KeyをOpentelemetryが現在提唱しているフォーマットに変えたくらいです。 参考: https://qiita.com/emonuh/items/28dbee9bf2fe51d28153\npackage logger import ( \"context\" \"go.opentelemetry.io/otel/trace\" \"go.uber.org/zap\" \"go.uber.org/zap/zapcore\" ) func GetZapLogger() (*zap.Logger, error) { level := zap.NewAtomicLevel() level.SetLevel(zapcore.DebugLevel) cfg := zap.Config{ Level: level, Encoding: \"json\", EncoderConfig: zapcore.EncoderConfig{ TimeKey: \"TimeStamp\", LevelKey: \"SeverityText\", NameKey: \"Name\", CallerKey: \"Caller\", MessageKey: \"Body\", EncodeLevel: zapcore.CapitalLevelEncoder, EncodeTime: zapcore.ISO8601TimeEncoder, EncodeDuration: zapcore.StringDurationEncoder, EncodeCaller: zapcore.ShortCallerEncoder, }, OutputPaths: []string{\"stdout\", \"/tmp/zap.log\"}, } logger, err := cfg.Build() if err != nil { return nil, err } return logger, nil } 上のloggerを呼び出すところは下記の通り\nfunc main() { zaplogger, err := logger.GetZapLogger() if err != nil { panic(err) } ... zaplogger.Info( fmt.Sprintf(\"server listening at %v\", lis.Addr()), logger.GetOtelLogMetadataFields(context.Background())..., ) } func GetOtelLogMetadataFields(ctx context.Context) []zap.Field { spanContext := trace.SpanContextFromContext(ctx) traceID := spanContext.TraceID().String() spanID := spanContext.SpanID().String() return []zap.Field{ zap.String(\"TraceId\", traceID), zap.String(\"SpanId\", spanID), zap.Any(\"Resource\", map[string]interface{}{ \"service.version\": \"1.0.0\", }), zap.Any(\"Attribute\", map[string]interface{}{ \"http.scheme\": \"http\", }), } } ポイントとしては、zapはnamespaceを利用することでログを階層化できるのだが、同じレベルでの階層を2つ作ることができない。\n参考: https://github.com/uber-go/zap/issues/351\nそのため上記Issueに書いてあるようにZap.Anyを使用して同じレベルでの階層化を実現した。\nまたspanはContextから獲得できたので、そこからSpanIDやTraceIDを獲得して、ログに出すことにした。 本当はAttributeなども取ってきたかったのだが、取ってくることができなかった…。 ReadOnlySpanとかから取得しているようなのですが、そのReadOnlySpanがどのように獲得されるかがわからず。。。\n以上の結果結果下記の通りにログが得ることができました。\n{ \"SeverityText\":\"INFO\", \"TimeStamp\":\"2022-05-03T04:16:33.474Z\", \"Caller\":\"server/server.go:105\", \"Body\":\"server listening at [::]:50051\", \"TraceId\":\"00000000000000000000000000000000\", \"SpanId\":\"0000000000000000\", \"Resource\":{ \"service.version\":\"1.0.0\" }, \"Attribute\":{ \"http.scheme\":\"http\" } } 今後の改善ポイントとして、context.Contextをlogの引数に加えることと、Attributeの出力あたりでしょうか？気が向けばヘルパーみたいなの作ってみます。\nまたOpenTelemetryでログを対応するためにはOpenTelemetyかなんかでTraceを実装しておくことが前段のステップかなと思っています。その準備をしておけ場いいのかなと思います。\n","wordCount":"3942","inLanguage":"ja","datePublished":"2022-05-02T21:06:46+09:00","dateModified":"2022-05-02T21:06:46+09:00","author":{"@type":"Person","name":"lottotto"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.lottohub.jp/posts/opentelemetry-zap/"},"publisher":{"@type":"Organization","name":"lottoHub","logo":{"@type":"ImageObject","url":"https://www.lottohub.jp/favicon.ico"}}}</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8721803444159352" crossorigin=anonymous></script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://www.lottohub.jp accesskey=h title="lottoHub (Alt + H)">lottoHub</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://www.lottohub.jp/about title=About>
<span>About</span>
</a>
</li>
<li>
<a href=https://www.lottohub.jp/archives title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://www.lottohub.jp/tags/ title=Tags>
<span>Tags</span>
</a>
</li>
<li>
<a href=https://www.lottohub.jp/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://www.lottohub.jp>Home</a>&nbsp;»&nbsp;<a href=https://www.lottohub.jp/posts/>Posts</a></div>
<h1 class=post-title>
OpenTelemetryのログ仕様をZAPで実装してみる
</h1>
<div class=post-meta><span title="2022-05-02 21:06:46 +0900 +0900">5月 2, 2022</span>&nbsp;·&nbsp;8 分&nbsp;·&nbsp;lottotto
</div>
</header> <div class=toc>
<details open>
<summary accesskey=c title="(Alt + C)">
<span class=details>目次</span>
</summary>
<div class=inner><ul>
<li>
<a href=#%e3%81%93%e3%81%ae%e8%a8%98%e4%ba%8b%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6 aria-label=この記事について>この記事について</a></li>
<li>
<a href=#%e3%83%ad%e3%82%ae%e3%83%b3%e3%82%b0%e3%81%a8%e3%81%af aria-label=ロギングとは>ロギングとは</a></li>
<li>
<a href=#%e3%83%ad%e3%82%b0%e3%81%ae%e7%9b%ae%e7%9a%84 aria-label=ログの目的>ログの目的</a></li>
<li>
<a href=#%e3%83%ad%e3%82%b0%e3%81%ae%e3%83%99%e3%82%b9%e3%83%88%e3%83%97%e3%83%a9%e3%82%af%e3%83%86%e3%82%a3%e3%82%b9 aria-label=ログのベストプラクティス>ログのベストプラクティス</a></li>
<li>
<a href=#opentelemetry%e3%81%ae%e3%83%ad%e3%82%b0%e3%81%ae%e7%8f%be%e7%8a%b6 aria-label=OpenTelemetryのログの現状>OpenTelemetryのログの現状</a><ul>
<li>
<a href=#%e3%83%87%e3%83%bc%e3%82%bf%e3%83%a2%e3%83%87%e3%83%ab aria-label=データモデル>データモデル</a></li>
<li>
<a href=#%e3%83%99%e3%82%b9%e3%83%88%e3%83%97%e3%83%a9%e3%82%af%e3%83%86%e3%82%a3%e3%82%b9%e3%81%a8%e3%81%ae%e5%af%be%e5%bf%9c%e7%8a%b6%e6%b3%81%e8%80%83%e5%af%9f aria-label=ベストプラクティスとの対応状況考察>ベストプラクティスとの対応状況考察</a></li></ul>
</li>
<li>
<a href=#opentelemetry%e3%81%ae%e3%83%ad%e3%82%b0%e5%af%be%e5%bf%9c%e3%82%92%e4%bb%a3%e3%82%8f%e3%82%8a%e3%81%abzap%e3%81%a7%e5%ae%9f%e8%a3%85%e3%81%97%e3%81%a6%e3%81%bf%e3%82%8b aria-label=Opentelemetryのログ対応を代わりにzapで実装してみる>Opentelemetryのログ対応を代わりにzapで実装してみる</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h2 id=この記事について>この記事について<a hidden class=anchor aria-hidden=true href=#この記事について>#</a></h2>
<p>まだOpenTelemetryのログに対しては仕様が固まっていない状況だが、情報がまとまっていないのでいろいろGithub見てまとめてみることを目的としている。</p>
<h2 id=ロギングとは>ロギングとは<a hidden class=anchor aria-hidden=true href=#ロギングとは>#</a></h2>
<p>wikipedia によると下記のように書かれています</p>
<blockquote>
<p>In computing, a log file is a file that records either events that occur in an operating system or other software runs, or messages between different users of a communication software.　Logging is the act of keeping a log.
<a href=https://en.wikipedia.org/wiki/Logging_(software)>https://en.wikipedia.org/wiki/Logging_(software)</a></p>
</blockquote>
<p>コンピューティングでは、ログファイルとは、OSや他のソフトウェアが稼働するときに発生するイベント,またはコミュニケーションソフトウェアでの異なるユーザ間でのメッセージを記録するファイルである。ロギングとはログを保持する行為であるといいます。</p>
<h2 id=ログの目的>ログの目的<a hidden class=anchor aria-hidden=true href=#ログの目的>#</a></h2>
<p>上記のログの定義や私個人の経験からログの目的については主に下記の4つが考えられます</p>
<ul>
<li>システムのイベントをログから解読し、稼働中か開発中のソフトウェアの障害根本原因を分析するために利用する</li>
<li>法律対応などの背景をもとにソフトウェアが提供する機能の一つとして、データの操作の監査証跡として利用する</li>
<li>ログを集計することで、ソフトウェアのメトリックを出したり、レイテンシを出したりするためのプロファイルとして利用する</li>
<li>ログを統計分析することで、実行しているユーザの動作やエラーの予防検知などの状態予想などに利用する</li>
</ul>
<h2 id=ログのベストプラクティス>ログのベストプラクティス<a hidden class=anchor aria-hidden=true href=#ログのベストプラクティス>#</a></h2>
<p>上記の目的を達成するためにはどのようなログのベストプラクティスが必要なのかを考えていきます。それと私なりの解釈を書いておきます</p>
<ol>
<li><strong>ログライブラリを利用すること</strong><br>
自前でprintfするのは管理が厳しくなるのでやめましょうという話。ベストプラクティスの前の基本動作. javaだったらlogbackだったり、goだったらzapだったり、いろいろ存在する。<br>
ただしlog4jのようなログライブラリへのバグが見つかるケースもあるので注意しておこう</li>
<li><strong>適切なレベルでログを記録すること</strong><br>
infoがなにとか、error が何とかはこちらを参照すること。https://ja.wikipedia.org/wiki/Log4j
いつも悩むINFOレベルの具体的なケースとしては、サービスにアクセスされたときの開始/終了情報, サービスから他のサービスやDBにアクセスしに行った時の開始/終了情報とかになるのかなぁ。<br>
WARNについては、例えばDBのアクセスが遅くなったり、キャッシュができなかった時に出すのがよくあるパターンっぽい</li>
<li><strong>適切なログのカテゴリを指定すること</strong><br>
ログを出すときにカテゴリを指定する。例えばモジュールごとだったり、DBのアクセスだったり、監査要件を満たす内容だったりでカテゴリつけると追うのが楽になるはず。</li>
<li><strong>意味のあるログメッセージを出力すること</strong><br>
session startとかだけだと何にもわからないので、意味のあるログメッセージを出しておく。運用側の意見が欲しいのでこことか聞いてみるとDevOpsになっていいかも。</li>
<li><strong>ログメッセージは英語で記載すること</strong><br>
あたりまえ体操</li>
<li><strong>ログメッセージにはコンテキスト情報を記載すること</strong><br>
transaction start とかにもcontext情報を付加して、transaction ID: 1qazxsw2 startとかつけるとよりわかりやすくなる。</li>
<li><strong>プログラムが解析しやすいフォーマットでログを出すこと</strong><br>
構造化しとけ</li>
<li><strong>同時に人間も読めるログのフォーマット形式にすること</strong><br>
障害分析するのは人間なんだから機械によめるだけじゃなくて人間にも読みやすくしようね。最近はjsonで出すのがトレンド</li>
<li><strong>ログに出す量は多すぎても、少なすぎてもいけないこと</strong><br>
といわれてもぶっちゃけ何取ればいいかわからん。そういう時は開発中はとりあえずログ出しておいて、運用しながら減らせばいい。簡単に減らせるようなアプリの作りにしておく</li>
<li><strong>ログを利用する人のことを考えること</strong><br>
後日読む人は開発者じゃない。他人のことを考えてログを出そう</li>
<li><strong>ログを障害分析のためだけに使わないこと</strong><br>
監査だったり、プロファイラだったり、統計利用だったりする。とくに統計分析とかは手段が目的化しやすいので、分析して何したいのとかを決めておくこと。</li>
<li><strong>ベンダーロックインを避けること</strong><br>
log4jとかでバグ見つかるから、ログのライブラリのロックインはきをつけよう。</li>
<li><strong>センシティブな情報をログに出さないこと</strong><br>
クレカ番号などの個人情報出ると事業おわるよ。</li>
</ol>
<p>参考: <a href=https://www.dataset.com/blog/the-10-commandments-of-logging/>https://www.dataset.com/blog/the-10-commandments-of-logging/</a></p>
<h2 id=opentelemetryのログの現状>OpenTelemetryのログの現状<a hidden class=anchor aria-hidden=true href=#opentelemetryのログの現状>#</a></h2>
<p>2022年5月現在のOpenTelemetryとしては、下記の状態。https://opentelemetry.io/status/
API: draft
SDK: draft
Protocol: beta
ログのデータモデルとしては実験的だが定義されている様子。APIやSDKなどすべてstableになるのは2~3年以上かかると考えました。
<a href=https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/logs/data-model.md>https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/logs/data-model.md</a>
参考:https://event.cloudnativedays.jp/o11y2022/talks/1347</p>
<h3 id=データモデル>データモデル<a hidden class=anchor aria-hidden=true href=#データモデル>#</a></h3>
<p>現在Opentelemetryが例示しているログレコードのフィールドは下記の通り</p>
<table>
<thead>
<tr>
<th>Field Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Timestamp</td>
<td>Time when the event occurred.</td>
</tr>
<tr>
<td>ObservedTimestamp</td>
<td>Time when the event was observed.</td>
</tr>
<tr>
<td>TraceId</td>
<td>Request trace id.</td>
</tr>
<tr>
<td>SpanId</td>
<td>Request span id.</td>
</tr>
<tr>
<td>TraceFlags</td>
<td>W3C trace flag.</td>
</tr>
<tr>
<td>SeverityText</td>
<td>The severity text (also known as log level).</td>
</tr>
<tr>
<td>SeverityNumber</td>
<td>Numerical value of the severity.</td>
</tr>
<tr>
<td>Body</td>
<td>The body of the log record.</td>
</tr>
<tr>
<td>Resource</td>
<td>Describes the source of the log.</td>
</tr>
<tr>
<td>InstrumentationScope</td>
<td>Describes the scope that emitted the log.</td>
</tr>
<tr>
<td>Attributes</td>
<td>Additional information about the event.</td>
</tr>
</tbody>
</table>
<p>特によくわからない、<code>Resource</code>については、ログを出しているPodの名前だったり、service名だったり、バージョンだったり、IPアドレスだったりが該当する。また<code>Attributes</code>については例えばHTTP上の情報などが該当する。より具体的には、UserAgentや、Statusコード、HTTPのパスなどが該当する。
上記の内容をベストプラクティスに従い、プログラムで読みやすく構造化して記録すると下記のようになる</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;Timestamp&#34;</span>: <span style=color:#e6db74>&#34;1586960586000000000&#34;</span>,
  <span style=color:#f92672>&#34;Attributes&#34;</span>: {
      <span style=color:#f92672>&#34;http.scheme&#34;</span>:<span style=color:#e6db74>&#34;https&#34;</span>,
      <span style=color:#f92672>&#34;http.host&#34;</span>:<span style=color:#e6db74>&#34;donut.mycie.com&#34;</span>,
      <span style=color:#f92672>&#34;http.target&#34;</span>:<span style=color:#e6db74>&#34;/order&#34;</span>,
      <span style=color:#f92672>&#34;http.method&#34;</span>:<span style=color:#e6db74>&#34;post&#34;</span>,
      <span style=color:#f92672>&#34;http.status_code&#34;</span>:<span style=color:#ae81ff>500</span>,
      <span style=color:#f92672>&#34;http.flavor&#34;</span>:<span style=color:#e6db74>&#34;1.1&#34;</span>,
      <span style=color:#f92672>&#34;http.user_agent&#34;</span>: <span style=color:#e6db74>&#34;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36&#34;</span>,
  },
  <span style=color:#f92672>&#34;Resource&#34;</span>: {
    <span style=color:#f92672>&#34;service.name&#34;</span>: <span style=color:#e6db74>&#34;donut_shop&#34;</span>,
    <span style=color:#f92672>&#34;service.version&#34;</span>: <span style=color:#e6db74>&#34;2.0.0&#34;</span>,
    <span style=color:#f92672>&#34;k8s.pod.uid&#34;</span>: <span style=color:#e6db74>&#34;1138528c-c36e-11e9-a1a7-42010a800198&#34;</span>,
  },
  <span style=color:#f92672>&#34;TraceId&#34;</span>: <span style=color:#e6db74>&#34;f4dbb3edd765f620&#34;</span>, <span style=color:#75715e>// this is a byte sequence
</span><span style=color:#75715e></span>                                 <span style=color:#75715e>// (hex-encoded in JSON)
</span><span style=color:#75715e></span>  <span style=color:#f92672>&#34;SpanId&#34;</span>: <span style=color:#e6db74>&#34;43222c2d51a7abe3&#34;</span>,
  <span style=color:#f92672>&#34;SeverityText&#34;</span>: <span style=color:#e6db74>&#34;INFO&#34;</span>,
  <span style=color:#f92672>&#34;SeverityNumber&#34;</span>: <span style=color:#ae81ff>9</span>,
  <span style=color:#f92672>&#34;Body&#34;</span>: <span style=color:#e6db74>&#34;20200415T072306-0700 INFO I like donuts&#34;</span>,
}
</code></pre></div><h3 id=ベストプラクティスとの対応状況考察>ベストプラクティスとの対応状況考察<a hidden class=anchor aria-hidden=true href=#ベストプラクティスとの対応状況考察>#</a></h3>
<p>このログレコードや将来Opentelemetryでログを実装することを考えた時、ベストプラクティスを達成しているかどうかについて考察してみる</p>
<table>
<thead>
<tr>
<th>ベストプラクティス</th>
<th>達成度</th>
<th>根拠</th>
</tr>
</thead>
<tbody>
<tr>
<td>1. ログライブラリを利用すること</td>
<td>達成</td>
<td>今はまだないけどOpentelemetryのライブラリを使うはずなのでできる</td>
</tr>
<tr>
<td>2. 適切なレベルでログを記録すること</td>
<td>未達成</td>
<td>ソフトウェアの作りに依存するため判断不可能</td>
</tr>
<tr>
<td>3. 適切なログのカテゴリを指定すること</td>
<td>達成</td>
<td><code>Resource</code>等にカテゴリ情報を記載することで可能</td>
</tr>
<tr>
<td>4. 意味のあるログメッセージを出力すること</td>
<td>未達成</td>
<td>ソフトウェアの作り次第</td>
</tr>
<tr>
<td>5. ログメッセージは英語で記載すること</td>
<td>達成</td>
<td>ソフトウェアの作り次第だが流石に大丈夫でしょう</td>
</tr>
<tr>
<td>6. ログメッセージにはコンテキスト情報を記載すること</td>
<td>達成</td>
<td>Opentelemetryでトレースがあるのでそれを出すだけだと思う</td>
</tr>
<tr>
<td>7. プログラムが解析しやすいフォーマットでログを出すこと</td>
<td>達成</td>
<td>JSONで構造化している</td>
</tr>
<tr>
<td>8. 同時に人間も読めるログのフォーマット形式にすること</td>
<td>達成</td>
<td>人間読めると思うし、jqでbodyだけ出せば…。改行が重要かな</td>
</tr>
<tr>
<td>9. ログに出す量は多すぎても、少なすぎてもいけないこと</td>
<td>未達成</td>
<td>ソフトウェアの作り次第</td>
</tr>
<tr>
<td>10. ログを利用する人のことを考えること</td>
<td>未達成</td>
<td>ソフトウェアの作り次第</td>
</tr>
<tr>
<td>11. ログを障害分析のためだけに使わないこと</td>
<td>達成</td>
<td>運用側次第だが、障害分析以外にも使える準備はできてる</td>
</tr>
<tr>
<td>12. ベンダーロックインを避けること</td>
<td>達成</td>
<td>Opentelemetryの考え方がベンダロックイン防止</td>
</tr>
<tr>
<td>13. センシティブな情報をログに出さないこと</td>
<td>未達成</td>
<td>ソフトウェアの作り次第</td>
</tr>
</tbody>
</table>
<p>ということで、Opentelemetryのフォーマットに従うだけで、8/13は達成しているのかなと思われる。</p>
<h2 id=opentelemetryのログ対応を代わりにzapで実装してみる>Opentelemetryのログ対応を代わりにzapで実装してみる<a hidden class=anchor aria-hidden=true href=#opentelemetryのログ対応を代わりにzapで実装してみる>#</a></h2>
<p>では上記のログレコードの形式で実装することで、結構ベストプラクティスを満たせそうなのでZapの練習がてらにやってみることとする。</p>
<p>Zapの初期設定に関しては下記の通り。Qiitaなどに記事が載っているのでそちらを参考にしました。ポイントとしては特にありません。KeyをOpentelemetryが現在提唱しているフォーマットに変えたくらいです。
参考: <a href=https://qiita.com/emonuh/items/28dbee9bf2fe51d28153>https://qiita.com/emonuh/items/28dbee9bf2fe51d28153</a></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go:logger.go data-lang=go:logger.go><span style=color:#f92672>package</span> <span style=color:#a6e22e>logger</span>

<span style=color:#f92672>import</span> (
	<span style=color:#e6db74>&#34;context&#34;</span>

	<span style=color:#e6db74>&#34;go.opentelemetry.io/otel/trace&#34;</span>
	<span style=color:#e6db74>&#34;go.uber.org/zap&#34;</span>
	<span style=color:#e6db74>&#34;go.uber.org/zap/zapcore&#34;</span>
)

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>GetZapLogger</span>() (<span style=color:#f92672>*</span><span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>Logger</span>, <span style=color:#66d9ef>error</span>) {

	<span style=color:#a6e22e>level</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>NewAtomicLevel</span>()
	<span style=color:#a6e22e>level</span>.<span style=color:#a6e22e>SetLevel</span>(<span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>DebugLevel</span>)
	<span style=color:#a6e22e>cfg</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>Config</span>{
		<span style=color:#a6e22e>Level</span>:    <span style=color:#a6e22e>level</span>,
		<span style=color:#a6e22e>Encoding</span>: <span style=color:#e6db74>&#34;json&#34;</span>,
		<span style=color:#a6e22e>EncoderConfig</span>: <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>EncoderConfig</span>{
			<span style=color:#a6e22e>TimeKey</span>:        <span style=color:#e6db74>&#34;TimeStamp&#34;</span>,
			<span style=color:#a6e22e>LevelKey</span>:       <span style=color:#e6db74>&#34;SeverityText&#34;</span>,
			<span style=color:#a6e22e>NameKey</span>:        <span style=color:#e6db74>&#34;Name&#34;</span>,
			<span style=color:#a6e22e>CallerKey</span>:      <span style=color:#e6db74>&#34;Caller&#34;</span>,
			<span style=color:#a6e22e>MessageKey</span>:     <span style=color:#e6db74>&#34;Body&#34;</span>,
			<span style=color:#a6e22e>EncodeLevel</span>:    <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>CapitalLevelEncoder</span>,
			<span style=color:#a6e22e>EncodeTime</span>:     <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>ISO8601TimeEncoder</span>,
			<span style=color:#a6e22e>EncodeDuration</span>: <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>StringDurationEncoder</span>,
			<span style=color:#a6e22e>EncodeCaller</span>:   <span style=color:#a6e22e>zapcore</span>.<span style=color:#a6e22e>ShortCallerEncoder</span>,
		},
		<span style=color:#a6e22e>OutputPaths</span>: []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;stdout&#34;</span>, <span style=color:#e6db74>&#34;/tmp/zap.log&#34;</span>},
	}
	<span style=color:#a6e22e>logger</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cfg</span>.<span style=color:#a6e22e>Build</span>()
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
	}
	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>logger</span>, <span style=color:#66d9ef>nil</span>
}
</code></pre></div><p>上のloggerを呼び出すところは下記の通り</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#a6e22e>zaplogger</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>GetZapLogger</span>()
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		panic(<span style=color:#a6e22e>err</span>)
	}

    <span style=color:#f92672>...</span>
    <span style=color:#a6e22e>zaplogger</span>.<span style=color:#a6e22e>Info</span>(
		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;server listening at %v&#34;</span>, <span style=color:#a6e22e>lis</span>.<span style=color:#a6e22e>Addr</span>()),
		<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>GetOtelLogMetadataFields</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>())<span style=color:#f92672>...</span>,
	)
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>GetOtelLogMetadataFields</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) []<span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>Field</span> {
	<span style=color:#a6e22e>spanContext</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>trace</span>.<span style=color:#a6e22e>SpanContextFromContext</span>(<span style=color:#a6e22e>ctx</span>)
	<span style=color:#a6e22e>traceID</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>spanContext</span>.<span style=color:#a6e22e>TraceID</span>().<span style=color:#a6e22e>String</span>()
	<span style=color:#a6e22e>spanID</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>spanContext</span>.<span style=color:#a6e22e>SpanID</span>().<span style=color:#a6e22e>String</span>()
	<span style=color:#66d9ef>return</span> []<span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>Field</span>{
		<span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>String</span>(<span style=color:#e6db74>&#34;TraceId&#34;</span>, <span style=color:#a6e22e>traceID</span>),
		<span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>String</span>(<span style=color:#e6db74>&#34;SpanId&#34;</span>, <span style=color:#a6e22e>spanID</span>),
		<span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>Any</span>(<span style=color:#e6db74>&#34;Resource&#34;</span>, <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}{
			<span style=color:#e6db74>&#34;service.version&#34;</span>: <span style=color:#e6db74>&#34;1.0.0&#34;</span>,
		}),
		<span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>Any</span>(<span style=color:#e6db74>&#34;Attribute&#34;</span>, <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}{
			<span style=color:#e6db74>&#34;http.scheme&#34;</span>: <span style=color:#e6db74>&#34;http&#34;</span>,
		}),
	}
}

</code></pre></div><p>ポイントとしては、zapはnamespaceを利用することでログを階層化できるのだが、同じレベルでの階層を2つ作ることができない。<br>
参考: <a href=https://github.com/uber-go/zap/issues/351>https://github.com/uber-go/zap/issues/351</a><br>
そのため上記Issueに書いてあるようにZap.Anyを使用して同じレベルでの階層化を実現した。</p>
<p>またspanはContextから獲得できたので、そこからSpanIDやTraceIDを獲得して、ログに出すことにした。
本当はAttributeなども取ってきたかったのだが、取ってくることができなかった&mldr;。
ReadOnlySpanとかから取得しているようなのですが、そのReadOnlySpanがどのように獲得されるかがわからず。。。</p>
<p>以上の結果結果下記の通りにログが得ることができました。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;SeverityText&#34;</span>:<span style=color:#e6db74>&#34;INFO&#34;</span>,
    <span style=color:#f92672>&#34;TimeStamp&#34;</span>:<span style=color:#e6db74>&#34;2022-05-03T04:16:33.474Z&#34;</span>,
    <span style=color:#f92672>&#34;Caller&#34;</span>:<span style=color:#e6db74>&#34;server/server.go:105&#34;</span>,
    <span style=color:#f92672>&#34;Body&#34;</span>:<span style=color:#e6db74>&#34;server listening at [::]:50051&#34;</span>,
    <span style=color:#f92672>&#34;TraceId&#34;</span>:<span style=color:#e6db74>&#34;00000000000000000000000000000000&#34;</span>,
    <span style=color:#f92672>&#34;SpanId&#34;</span>:<span style=color:#e6db74>&#34;0000000000000000&#34;</span>,
    <span style=color:#f92672>&#34;Resource&#34;</span>:{
        <span style=color:#f92672>&#34;service.version&#34;</span>:<span style=color:#e6db74>&#34;1.0.0&#34;</span>
    },
    <span style=color:#f92672>&#34;Attribute&#34;</span>:{
        <span style=color:#f92672>&#34;http.scheme&#34;</span>:<span style=color:#e6db74>&#34;http&#34;</span>
    }
}
</code></pre></div><p>今後の改善ポイントとして、<code>context.Context</code>をlogの引数に加えることと、Attributeの出力あたりでしょうか？気が向けばヘルパーみたいなの作ってみます。<br>
またOpenTelemetryでログを対応するためにはOpenTelemetyかなんかでTraceを実装しておくことが前段のステップかなと思っています。その準備をしておけ場いいのかなと思います。</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://www.lottohub.jp/tags/go/>Go</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://www.lottohub.jp/posts/build-jar-gitlab/>
<span class=title>« 前のページ</span>
<br>
<span>gitlabでカバレッジ, Junit, codequalityのartifactsを全部出す</span>
</a>
<a class=next href=https://www.lottohub.jp/posts/go-mutex/>
<span class=title>次のページ »</span>
<br>
<span>Go言語の排他制御について</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share OpenTelemetryのログ仕様をZAPで実装してみる on twitter" href="https://twitter.com/intent/tweet/?text=OpenTelemetry%e3%81%ae%e3%83%ad%e3%82%b0%e4%bb%95%e6%a7%98%e3%82%92ZAP%e3%81%a7%e5%ae%9f%e8%a3%85%e3%81%97%e3%81%a6%e3%81%bf%e3%82%8b&url=https%3a%2f%2fwww.lottohub.jp%2fposts%2fopentelemetry-zap%2f&hashtags=Go"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share OpenTelemetryのログ仕様をZAPで実装してみる on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.lottohub.jp%2fposts%2fopentelemetry-zap%2f&title=OpenTelemetry%e3%81%ae%e3%83%ad%e3%82%b0%e4%bb%95%e6%a7%98%e3%82%92ZAP%e3%81%a7%e5%ae%9f%e8%a3%85%e3%81%97%e3%81%a6%e3%81%bf%e3%82%8b&summary=OpenTelemetry%e3%81%ae%e3%83%ad%e3%82%b0%e4%bb%95%e6%a7%98%e3%82%92ZAP%e3%81%a7%e5%ae%9f%e8%a3%85%e3%81%97%e3%81%a6%e3%81%bf%e3%82%8b&source=https%3a%2f%2fwww.lottohub.jp%2fposts%2fopentelemetry-zap%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share OpenTelemetryのログ仕様をZAPで実装してみる on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.lottohub.jp%2fposts%2fopentelemetry-zap%2f&title=OpenTelemetry%e3%81%ae%e3%83%ad%e3%82%b0%e4%bb%95%e6%a7%98%e3%82%92ZAP%e3%81%a7%e5%ae%9f%e8%a3%85%e3%81%97%e3%81%a6%e3%81%bf%e3%82%8b"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share OpenTelemetryのログ仕様をZAPで実装してみる on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.lottohub.jp%2fposts%2fopentelemetry-zap%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share OpenTelemetryのログ仕様をZAPで実装してみる on whatsapp" href="https://api.whatsapp.com/send?text=OpenTelemetry%e3%81%ae%e3%83%ad%e3%82%b0%e4%bb%95%e6%a7%98%e3%82%92ZAP%e3%81%a7%e5%ae%9f%e8%a3%85%e3%81%97%e3%81%a6%e3%81%bf%e3%82%8b%20-%20https%3a%2f%2fwww.lottohub.jp%2fposts%2fopentelemetry-zap%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share OpenTelemetryのログ仕様をZAPで実装してみる on telegram" href="https://telegram.me/share/url?text=OpenTelemetry%e3%81%ae%e3%83%ad%e3%82%b0%e4%bb%95%e6%a7%98%e3%82%92ZAP%e3%81%a7%e5%ae%9f%e8%a3%85%e3%81%97%e3%81%a6%e3%81%bf%e3%82%8b&url=https%3a%2f%2fwww.lottohub.jp%2fposts%2fopentelemetry-zap%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2023 <a href=https://www.lottohub.jp>lottoHub</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light'),theme=''):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'),theme='dark'),mermaidTextContents.forEach((b,a)=>{document.getElementsByClassName("language-mermaid")[a].removeAttribute('data-processed'),document.getElementsByClassName("language-mermaid")[a].innerHTML=b}),mermaid.initialize({theme,startOnLoad:!0}),mermaid.init(void 0,'.language-mermaid')})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
<script>localStorage.getItem("pref-theme")=='dark'?theme='dark':theme='',mermaidTextContents=Array.from(document.getElementsByClassName("language-mermaid")).map(a=>a.innerHTML),mermaid.initialize({theme,startOnLoad:!0}),mermaid.init(void 0,'.language-mermaid')</script>
</body>
</html>